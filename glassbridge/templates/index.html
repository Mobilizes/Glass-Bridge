<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Glass Bridge</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="header">
      <h1>Glass Bridge</h1>
      <p>{{ quotes }}</p>
      <br>
      <h2><span id="countdown"></span></h2>
    </div>

    <div class="bridge" id="bridge">
      {% for step in steps %}
      <div class="step-row">
        <div class="step-number">#{{ step.id }}</div>
        <div class="glass-panel left step-{{step.id}}" style="
          {% if step.stepped and step.correct == 'r' %}
            opacity: 20% !important;
            pointer-events: none !important;
          {% endif %}"
        >
          <div class="tooltip left {% if step.survivors == 1 %}fresh{% endif %}">
            {% if step.survivors == 0 %}
              Which one is the correct one?
            {% elif step.survivors == 1 %}
              Here!
            {% else %}
              {{step.survivors}} survivors has crossed beyond this step...
            {% endif %}
          </div>
        </div>
        <div class="glass-panel right step-{{step.id}}" style="
          {% if step.stepped and step.correct == 'l' %}
            opacity: 20% !important;
            pointer-events: none !important;
          {% endif %}"
        >
          <div class="tooltip right {% if step.survivors == 1 %}fresh{% endif %}">
            {% if step.survivors == 0 %}
              Which one is the correct one?
            {% elif step.survivors == 1 %}
              Here!
            {% else %}
              {{step.survivors}} survivors has crossed beyond this step...
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="footer">
      <button class="scroll-down">Down</button>
      <button class="scroll-top">Top</button>
    </div>
  </body>
  <script>
    const endTime = new Date("{{ end_time }}").getTime();

    function updateCountdown() {
      const now = new Date().getTime();
      const diff = endTime - now;

      if (diff <= 0) {
        document.getElementById("countdown").textContent = "00:00:00";
        clearInterval(interval);
        return;
      }

      const hours = Math.floor(diff / 1000 / 60 / 60);
      const minutes = Math.floor(diff / 1000 / 60 % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("countdown").textContent =
        `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    }

    document.querySelector('.scroll-down').addEventListener('click', () => {
      document.querySelector('.step-{{last_step}}').scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    });

    document.querySelector('.scroll-top').addEventListener('click', () => {
      document.querySelector('.header').scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    });

    updateCountdown();
    const interval = setInterval(updateCountdown, 1000);
  </script>
</html>
